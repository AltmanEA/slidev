# Тесты LectureDiscoveryService

## Обзор

Этот файл содержит комплексные тесты для `LectureDiscoveryService`, который отвечает за обнаружение и валидацию лекций в директории slides/.

**Файл тестов:** `src/test/suite/lectureDiscovery.test.ts`

## Структура тестов

### Тестовая директория
Тесты используют реальную файловую структуру в директории `test-lectures/`:
- `lecture-1/` - Валидная лекция с полными метаданными
- `lecture-2/` - Валидная лекция только с обязательным полем title
- `lecture-3/` - Лекция без frontmatter
- `lecture-4/` - Лекция без обязательного поля title
- `lecture-5/` - Лекция с невалидным форматом даты
- `lecture-6/` - Директория без файла slides.md
- `lecture-7/` - Валидная лекция с датой в будущем

## Покрытые сценарии

### 1. discoverLectures()
- ✅ Обнаружение всех лекций в директории
- ✅ Сортировка лекций по ID
- ✅ Подсчет валидных и невалидных лекций
- ✅ Сбор ошибок валидации

### 2. validateLecture()
- ✅ Валидация корректной лекции с полными метаданными
- ✅ Валидация лекции без optional полей
- ✅ Отклонение лекции без frontmatter
- ✅ Отклонение лекции без обязательного поля title
- ✅ Обработка лекции с невалидным форматом даты
- ✅ Обработка несуществующей лекции

### 3. extractMetadata()
- ✅ Извлечение всех полей метаданных
- ✅ Обработка отсутствующих optional полей
- ✅ Обработка некорректных типов данных
- ✅ Обработка пустых строк
- ✅ Обработка ошибок извлечения метаданных

### 4. isValidDateFormat()
- ✅ Принятие корректных дат (YYYY-MM-DD)
- ✅ Отклонение некорректных форматов дат
- ✅ Валидация реальных дат (включая високосные годы)

### 5. findLectureById()
- ✅ Поиск существующей лекции
- ✅ Возврат undefined для несуществующей лекции

### 6. getValidLectures()
- ✅ Возврат только валидных лекций
- ✅ Проверка статуса всех возвращенных лекций

### 7. getStatistics()
- ✅ Корректный подсчет общего количества лекций
- ✅ Корректный подсчет валидных и невалидных лекций
- ✅ Детализированная статистика по типам ошибок

### 8. Интеграционные тесты
- ✅ Полный цикл обнаружения лекций
- ✅ Проверка структуры результата
- ✅ Валидация корректности подсчетов

## Запуск тестов

```bash
# Компиляция проекта
pnpm run compile

# Запуск только тестов lectureDiscovery
npx mocha out/test/suite/lectureDiscovery.test.js --reporter spec

# Запуск всех unit-тестов
pnpm run test:unit
```

## Тестовые данные

### Валидная лекция (lecture-1)
```yaml
---
title: "Introduction to Programming"
description: "Basic concepts of programming"
date: "2024-01-15"
---
```

### Минимальная валидная лекция (lecture-2)
```yaml
---
title: "Data Structures"
---
```

### Невалидные сценарии
- **lecture-3**: Отсутствует frontmatter
- **lecture-4**: Отсутствует обязательное поле `title`
- **lecture-5**: Невалидный формат даты (2024/01/17)
- **lecture-6**: Отсутствует файл slides.md

## Покрытие функциональности

Тесты покрывают все основные методы `LectureDiscoveryService`:

1. **Обнаружение лекций** - поиск и анализ всех лекций в директории
2. **Валидация лекций** - проверка корректности структуры и метаданных
3. **Извлечение метаданных** - парсинг и валидация frontmatter
4. **Валидация дат** - проверка формата дат в метаданных
5. **Поиск по ID** - быстрый поиск конкретной лекции
6. **Фильтрация** - получение только валидных лекций
7. **Статистика** - подсчет и категоризация лекций
8. **Обработка ошибок** - корректная обработка различных ошибок

## Результаты тестирования

✅ **31 тест проходит успешно**
- Все основные методы протестированы
- Покрыты граничные случаи и ошибки
- Интеграционные сценарии работают корректно

## Примечания

- Тесты используют реальные файлы для максимальной достоверности
- Все тесты изолированы и не зависят друг от друга
- Тестовая структура файлов создается автоматически при запуске
- Поддерживается проверка различных форматов ошибок и состояний