# Тестирование FrontmatterParser

Документация по тестам для сервиса `FrontmatterParser`.

## Обзор

`FrontmatterParser` — сервис для парсинга и валидации YAML frontmatter из файлов `slides.md`. Согласно спецификации SPEC.md, frontmatter является единственным источником метаданных лекции.

## Тестовый файл

`src/test/suite/frontmatterParser.test.ts`

## Покрытие тестами

### Методы

| Метод | Тесты | Описание |
|-------|-------|----------|
| `parse()` | 18 | Парсинг frontmatter с различными сценариями |
| `isValid()` | 3 | Проверка валидности frontmatter |
| `extractMetadata()` | 2 | Извлечение метаданных |
| `hasTitle()` | 4 | Проверка наличия title |

## Тестовые сценарии

### 1. Базовый парсинг (5 тестов)

| Тест | Описание | Ожидаемый результат |
|------|----------|---------------------|
| Полный frontmatter | Все поля (title, description, date) | Валидный, метаданные извлечены |
| Только title | Только обязательное поле | Валидный, optional поля undefined |
| Пустые optional поля | description и date пустые | Валидный, пустые поля → undefined |
| Без разделителей | Контент без `---` | Ошибка NO_FRONTMATTER |
| Пустой frontmatter | Только разделители | Ошибка EMPTY_FRONTMATTER |

### 2. Валидация title (4 теста)

| Тест | Вход | Ожидаемый результат |
|------|------|---------------------|
| Отсутствует | Нет поля `title` | Ошибка MISSING_TITLE |
| Пустая строка | `title: ""` | Ошибка EMPTY_TITLE |
| Только пробелы | `title: "   "` | Ошибка EMPTY_TITLE |
| Число | `title: 123` | Валидный, title = "123" |

### 3. Валидация date (5 тестов)

| Тест | Вход | Ожидаемый результат |
|------|------|---------------------|
| Валидные даты | `2024-01-15`, `2020-12-31` | Принято |
| Невалидный формат | `2024/01/15`, `24-01-15` | Ошибка INVALID_DATE_FORMAT |
| Несуществующие даты | `2024-13-15`, `2024-01-32` | Ошибка INVALID_DATE_VALUE |
| Високосный год | `2024-02-29` | Принято |
| Число | `date: 20240115` | Парсится как строка |

### 4. Обработка типов данных (3 теста)

| Тип | Описание | Ожидаемый результат |
|-----|----------|---------------------|
| null | `description: null` | undefined |
| boolean | `title: true`, `description: false` | Преобразуется в строку "true"/"false" |
| Пробелы | `title: "  Test  "` | Обрезаются до "Test" |

### 5. Обработка ошибок (2 теста)

| Сценарий | Описание |
|----------|----------|
| Ошибки YAML | Невалидный YAML синтаксис |
| Множественные ошибки | Несколько ошибок валидации сразу |

### 6. Граничные случаи (5 тестов)

| Тест | Описание |
|------|----------|
| Длинный title | 1000+ символов |
| Специальные символы | `: " ' & < > [] {}` |
| Кириллица | Русский текст в полях |
| Multiline description | Описание в несколько строк |
| Дополнительные поля | author, tags, version — игнорируются |

### 7. Интеграционные тесты (3 теста)

| Тест | Файл | Проверка |
|------|------|----------|
| lecture-1 | `test-lectures/lecture-1/slides.md` | Полный frontmatter |
| lecture-2 | `test-lectures/lecture-2/slides.md` | Только title |
| lecture-3 | `test-lectures/lecture-3/slides.md` | Без frontmatter |

## Запуск тестов

```bash
# Запуск только тестов FrontmatterParser
pnpm run test:unit -- --grep "FrontmatterParser"

# Или напрямую
npx mocha out/test/suite/frontmatterParser.test.js --reporter spec
```

## Коды ошибок валидации

| Код | Описание |
|-----|----------|
| `NO_FRONTMATTER` | Файл не содержит frontmatter (нет `---`) |
| `EMPTY_FRONTMATTER` | Frontmatter пустой (нет данных между `---`) |
| `MISSING_TITLE` | Обязательное поле `title` отсутствует |
| `EMPTY_TITLE` | Поле `title` пустое |
| `INVALID_DATE_FORMAT` | Дата не соответствует формату YYYY-MM-DD |
| `INVALID_DATE_VALUE` | Дата невалидна (несуществующий месяц/день) |
| `PARSE_ERROR` | Ошибка парсинга YAML |

## Соответствие спецификации

Тесты проверяют соответствие требованиям SPEC.md:

- ✅ Поддержка полей: `title` (REQUIRED), `description` (OPTIONAL), `date` (OPTIONAL)
- ✅ Формат даты: YYYY-MM-DD
- ✅ Frontmatter как единственный источник метаданных
- ✅ Валидация обязательных полей
- ✅ Обработка граничных случаев

## Зависимости

- **gray-matter** — библиотека для парсинга YAML frontmatter
- **Mocha** — тестовый фреймворк
- **Assert** — модуль assertions